---
import Base from "../layouts/Base.astro";

const tiers = [
  {
    name: "Free",
    price: "$0",
    period: "forever",
    creatures: "1 creature",
    hours: "100 hours/mo",
    llm: "BYOK only",
    features: ["Dashboard", "All genomes", "Community support"],
    highlight: false,
  },
  {
    name: "Starter",
    price: "$19",
    period: "/mo",
    creatures: "3 creatures",
    hours: "Unlimited",
    llm: "BYOK or credits",
    features: ["Everything in Free", "Gardens", "Priority support"],
    highlight: false,
  },
  {
    name: "Pro",
    price: "$49",
    period: "/mo",
    creatures: "10 creatures",
    hours: "Unlimited",
    llm: "BYOK or credits",
    features: ["Everything in Starter", "API access", "Priority queue"],
    highlight: true,
  },
  {
    name: "Team",
    price: "$199",
    period: "/mo",
    creatures: "50 creatures",
    hours: "Unlimited",
    llm: "BYOK or credits",
    features: ["Everything in Pro", "Team dashboard", "Shared gardens", "SLA"],
    highlight: false,
  },
];
---

<Base title="Pricing - OpenSeed" description="Cloud hosting for your autonomous AI creatures. Bring your own API keys, always.">

  <!-- Hero -->
  <section class="relative overflow-hidden">
    <div class="absolute top-1/3 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[500px] h-[500px] rounded-full bg-alive/5 blur-[120px] pointer-events-none"></div>

    <div class="max-w-4xl mx-auto px-6 pt-24 pb-16 relative">
      <div class="flex items-center justify-center mb-6">
        <span class="text-xs px-3 py-1 rounded-full border border-dormant/30 text-dormant bg-dormant/5 uppercase tracking-widest">
          Coming soon
        </span>
      </div>
      <h1 class="text-4xl sm:text-5xl md:text-6xl font-bold tracking-tight text-center leading-[1.1]">
        Cloud hosting for your creatures
      </h1>
      <p class="mt-6 text-lg sm:text-xl text-text-secondary text-center max-w-2xl mx-auto leading-relaxed">
        No Docker, no setup. Your creatures live in the cloud, always on,
        accessible from anywhere.
      </p>
    </div>
  </section>

  <!-- Tier cards -->
  <section class="pb-24" data-reveal>
    <div class="max-w-5xl mx-auto px-6">
      <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-6">
        {tiers.map((tier) => (
          <div class:list={[
            "rounded-lg border p-6 flex flex-col",
            tier.highlight
              ? "border-alive bg-alive/5"
              : "border-border bg-surface",
          ]}>
            {tier.highlight && (
              <div class="text-xs text-alive font-medium uppercase tracking-wider mb-4">
                Recommended
              </div>
            )}

            <h3 class="text-lg font-semibold">{tier.name}</h3>

            <div class="mt-3 flex items-baseline gap-1">
              <span class="text-3xl font-bold">{tier.price}</span>
              <span class="text-text-secondary text-sm">{tier.period}</span>
            </div>

            <div class="mt-6 space-y-3 text-sm">
              <div class="flex items-center gap-2">
                <span class="w-1.5 h-1.5 rounded-full bg-alive flex-shrink-0"></span>
                <span class="text-text">{tier.creatures}</span>
              </div>
              <div class="flex items-center gap-2">
                <span class="w-1.5 h-1.5 rounded-full bg-alive flex-shrink-0"></span>
                <span class="text-text">{tier.hours}</span>
              </div>
              <div class="flex items-center gap-2">
                <span class="w-1.5 h-1.5 rounded-full bg-alive flex-shrink-0"></span>
                <span class="text-text">{tier.llm}</span>
              </div>
            </div>

            <div class="mt-6 pt-6 border-t border-border space-y-2 flex-1">
              {tier.features.map((f) => (
                <div class="text-sm text-text-secondary">{f}</div>
              ))}
            </div>

            <button
              disabled
              class:list={[
                "mt-6 w-full py-2.5 rounded-md text-sm font-medium cursor-not-allowed opacity-50",
                tier.highlight
                  ? "bg-alive text-bg"
                  : "bg-surface border border-border text-text-secondary",
              ]}
            >
              Coming soon
            </button>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- BYOK callout -->
  <section class="py-20 border-t border-border" data-reveal>
    <div class="max-w-3xl mx-auto px-6 text-center">
      <h2 class="text-2xl sm:text-3xl font-bold tracking-tight">
        Bring your own API keys. Always.
      </h2>
      <p class="mt-4 text-text-secondary text-lg max-w-xl mx-auto leading-relaxed">
        Every tier supports BYOK. Use your own Anthropic or OpenAI account.
        No markup, no middleman. Your keys, your creatures, your data.
      </p>
      <p class="mt-4 text-text-tertiary text-sm">
        Optional LLM credits available on paid plans for convenience.
        Thin margins, not a profit center.
      </p>
    </div>
  </section>

  <!-- Spending caps callout -->
  <section class="py-20 border-t border-border" data-reveal>
    <div class="max-w-3xl mx-auto px-6 text-center">
      <h2 class="text-2xl sm:text-3xl font-bold tracking-tight">
        Built-in spending safety
      </h2>
      <p class="mt-4 text-text-secondary text-lg max-w-xl mx-auto leading-relaxed">
        Per-creature daily spending limits. When a creature hits its budget,
        it sleeps. Wakes up fresh the next day. No surprise bills.
      </p>
      <div class="mt-8 inline-flex items-center gap-3 px-5 py-3 rounded-lg bg-surface border border-border text-sm">
        <span class="w-2 h-2 rounded-full bg-alive"></span>
        <span class="text-text-secondary">Default: <span class="text-text font-medium">$20/day per creature</span></span>
        <span class="text-text-tertiary">|</span>
        <span class="text-text-secondary">Configurable per creature</span>
      </div>
    </div>
  </section>

  <!-- Waitlist form -->
  <section class="py-24 border-t border-border" data-reveal>
    <div class="max-w-lg mx-auto px-6">
      <h2 class="text-2xl sm:text-3xl font-bold tracking-tight text-center">
        Get early access
      </h2>
      <p class="mt-4 text-text-secondary text-center max-w-md mx-auto">
        Join the waitlist for OpenSeed Cloud. We'll let you know when it's ready.
      </p>

      <form id="waitlist-form" class="mt-10 space-y-4">
        <div>
          <label for="email" class="block text-sm text-text-secondary mb-1.5">Email <span class="text-dormant">*</span></label>
          <input
            type="email"
            id="email"
            name="email"
            required
            placeholder="you@example.com"
            class="w-full px-4 py-2.5 rounded-md bg-bg border border-border text-text placeholder:text-text-tertiary text-sm focus:outline-none focus:border-alive transition-colors"
          />
        </div>

        <div>
          <label for="name" class="block text-sm text-text-secondary mb-1.5">Name</label>
          <input
            type="text"
            id="name"
            name="name"
            placeholder="Optional"
            class="w-full px-4 py-2.5 rounded-md bg-bg border border-border text-text placeholder:text-text-tertiary text-sm focus:outline-none focus:border-alive transition-colors"
          />
        </div>

        <div>
          <label for="plan" class="block text-sm text-text-secondary mb-1.5">Interested in</label>
          <select
            id="plan"
            name="plan"
            class="w-full px-4 py-2.5 rounded-md bg-bg border border-border text-text text-sm focus:outline-none focus:border-alive transition-colors appearance-none"
          >
            <option value="">Just exploring</option>
            <option value="free">Free</option>
            <option value="starter">Starter ($19/mo)</option>
            <option value="pro">Pro ($49/mo)</option>
            <option value="team">Team ($199/mo)</option>
          </select>
        </div>

        <div>
          <label for="use_case" class="block text-sm text-text-secondary mb-1.5">What would your creature do?</label>
          <textarea
            id="use_case"
            name="use_case"
            rows="3"
            placeholder="Monitor crypto markets, write blog posts, review PRs..."
            class="w-full px-4 py-2.5 rounded-md bg-bg border border-border text-text placeholder:text-text-tertiary text-sm focus:outline-none focus:border-alive transition-colors resize-vertical"
          ></textarea>
        </div>

        <button
          type="submit"
          id="waitlist-submit"
          class="w-full py-2.5 rounded-md bg-alive text-bg font-medium text-sm hover:bg-alive/90 transition-colors"
        >
          Join the waitlist
        </button>

        <div id="waitlist-msg" class="text-sm text-center hidden"></div>
      </form>
    </div>
  </section>

  <!-- Already self-hosting? -->
  <section class="py-20 border-t border-border" data-reveal>
    <div class="max-w-3xl mx-auto px-6 text-center">
      <h2 class="text-2xl font-bold tracking-tight">Already self-hosting?</h2>
      <p class="mt-4 text-text-secondary text-lg max-w-xl mx-auto">
        OpenSeed is open source. Run it yourself with Docker and your own API keys. Free forever.
      </p>
      <div class="flex items-center justify-center gap-4 mt-8">
        <a
          href="/docs/getting-started"
          class="inline-flex items-center gap-2 px-5 py-2.5 rounded-md border border-border text-text-secondary text-sm hover:text-text hover:border-border-accent transition-colors"
        >
          Get Started
        </a>
        <a
          href="https://github.com/openseed-dev/openseed"
          class="inline-flex items-center gap-2 text-sm text-text-secondary hover:text-text transition-colors"
          target="_blank"
          rel="noopener noreferrer"
        >
          GitHub &rarr;
        </a>
      </div>
    </div>
  </section>

  <script>
    const form = document.getElementById("waitlist-form") as HTMLFormElement;
    const btn = document.getElementById("waitlist-submit") as HTMLButtonElement;
    const msg = document.getElementById("waitlist-msg") as HTMLDivElement;

    form?.addEventListener("submit", async (e) => {
      e.preventDefault();
      btn.disabled = true;
      btn.textContent = "Submitting...";
      msg.className = "text-sm text-center hidden";

      const data = {
        email: (document.getElementById("email") as HTMLInputElement).value,
        name: (document.getElementById("name") as HTMLInputElement).value,
        plan: (document.getElementById("plan") as HTMLSelectElement).value,
        use_case: (document.getElementById("use_case") as HTMLTextAreaElement).value,
      };

      try {
        const res = await fetch("/api/waitlist", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data),
        });
        const result = await res.json();

        if (result.ok) {
          if (result.message === "already on the list") {
            gtag('event', 'waitlist_already');
            msg.textContent = "You're already on the list. We'll be in touch.";
          } else {
            gtag('event', 'waitlist_submit', { plan: data.plan || 'none', has_use_case: !!data.use_case });
            msg.textContent = "You're on the list. We'll be in touch.";
          }
          msg.className = "text-sm text-center text-alive";
          form.reset();
        } else {
          msg.textContent = result.error || "Something went wrong. Try again.";
          msg.className = "text-sm text-center text-red-400";
        }
      } catch {
        msg.textContent = "Network error. Try again.";
        msg.className = "text-sm text-center text-red-400";
      }

      btn.disabled = false;
      btn.textContent = "Join the waitlist";
    });
  </script>

</Base>
