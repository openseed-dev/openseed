---
import Base from "../../layouts/Base.astro";
import { getCollection } from "astro:content";

function blogSort(a: { data: { date: string; order?: number } }, b: { data: { date: string; order?: number } }) {
  const dt = new Date(b.data.date).getTime() - new Date(a.data.date).getTime();
  if (dt !== 0) return dt;
  return (b.data.order ?? 0) - (a.data.order ?? 0);
}

const collectionPosts = (await getCollection("blog")).sort(blogSort);

const standalonePosts = [
  {
    id: "eves-adventure",
    data: {
      title: "Eve's Adventure Game",
      description: "Eve built an 18-room text adventure as a metaphor for her ecosystem. You can play it here.",
      date: "2026-02-17",
    },
    standalone: true,
  },
];

const posts = [
  ...collectionPosts.map((p) => ({ ...p, standalone: false })),
  ...standalonePosts,
].sort(blogSort);
---

<Base title="Blog - OpenSeed" description="Stories, technical deep dives, and updates from the OpenSeed project.">
  <header class="blog-index-header">
    <div class="max-w-3xl mx-auto px-6">
      <h1 class="blog-index-title">Blog</h1>
      <p class="blog-index-subtitle">Stories from the garden.</p>
    </div>
  </header>

  <section class="max-w-3xl mx-auto px-6 pb-24">
    <div class="blog-index-list">
      {posts.map((post, i) => {
        const formatted = new Date(post.data.date + "T00:00:00Z").toLocaleDateString("en-US", {
          year: "numeric",
          month: "long",
          day: "numeric",
          timeZone: "UTC",
        });
        return (
          <a
            href={`/blog/${post.id}`}
            class="blog-entry"
            data-reveal
            style={`transition-delay: ${i * 80}ms`}
          >
            <time datetime={post.data.date} class="blog-entry-date">{formatted}</time>
            <h2 class="blog-entry-title">{post.data.title}</h2>
            <p class="blog-entry-desc">{post.data.description}</p>
          </a>
        );
      })}
    </div>
  </section>
</Base>

<style>
  .blog-index-header {
    padding-top: 5rem;
    padding-bottom: 3rem;
    background: linear-gradient(180deg, var(--color-surface) 0%, var(--color-bg) 100%);
    border-bottom: 1px solid var(--color-border);
    border-top: 2px solid color-mix(in srgb, var(--color-alive) 40%, transparent);
    margin-bottom: 3rem;
  }

  .blog-index-title {
    font-family: var(--font-display);
    font-size: clamp(2.5rem, 6vw, 3.5rem);
    font-weight: 500;
    letter-spacing: -0.02em;
    line-height: 1.1;
    color: var(--color-text);
  }

  .blog-index-subtitle {
    margin-top: 0.75rem;
    font-size: 1.125rem;
    color: var(--color-text-tertiary);
    font-style: italic;
    font-family: var(--font-display);
  }

  .blog-index-list {
    display: flex;
    flex-direction: column;
  }

  .blog-entry {
    display: block;
    padding: 2.5rem 0;
    border-bottom: 1px solid var(--color-border);
    text-decoration: none;
  }

  .blog-entry:first-child {
    padding-top: 0;
  }

  .blog-entry:last-child {
    border-bottom: none;
  }

  .blog-entry-date {
    display: block;
    font-size: 0.8125rem;
    color: var(--color-text-tertiary);
    margin-bottom: 0.75rem;
  }

  .blog-entry-title {
    font-family: var(--font-display);
    font-size: 1.625rem;
    font-weight: 500;
    letter-spacing: -0.01em;
    line-height: 1.3;
    color: var(--color-text);
    transition: color 0.25s ease;
  }

  .blog-entry:hover .blog-entry-title {
    color: var(--color-alive);
  }

  .blog-entry-desc {
    margin-top: 0.75rem;
    font-size: 0.875rem;
    line-height: 1.6;
    color: var(--color-text-secondary);
    max-width: 55ch;
  }
</style>
